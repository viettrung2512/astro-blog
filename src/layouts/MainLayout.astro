---
// src/layouts/MainLayout.astro
import Navbar from '../components/Navbar.astro';
import Footer from '../components/Footer.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../constants';

interface Props {
  title?: string;
  needToast?: boolean;
}

const { title = 'Articles, Stories & Tutorials For Tech People' } = Astro.props;
const pageTitle = `${SITE_TITLE} - ${title}`;
---

<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
  <head>
    <!-- Meta charset và viewport -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- Meta tags quan trọng -->
    <title>{pageTitle}</title>
    <meta name="description" content={SITE_DESCRIPTION} />
    <meta name="theme-color" content="#ffffff" />
    
    <!-- Preload các tài nguyên quan trọng -->
    <link rel="preload" href="/fonts/Inter.woff2" as="font" type="font/woff2" crossorigin />
    <link rel="preload" href="/styles/main.css" as="style" />
    
    <!-- Preconnect đến các domain bên ngoài -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" />
    
    <!-- Tải CSS -->
    <link rel="stylesheet" href="/styles/main.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet" />

    <!-- Inline critical CSS -->
    <style is:inline>
      :root {
        --color-primary: #2563eb;
        --color-text: #1f2937;
      }
      body {
        font-family: 'Inter', sans-serif;
        color: var(--color-text);
        line-height: 1.6;
      }
      .container {
        width: 100%;
        max-width: 1280px;
        margin-left: auto;
        margin-right: auto;
      }
    </style>
    
    <!-- Tải script Flowbite một cách tối ưu -->
    <script 
      src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.0/flowbite.min.js"
      integrity="sha512-BJ/5sR2hFxQTKin/55JQCcMTObShDBAmVjL/3NR/MVcrhyOazJjAgvROem03+HYyGw16SVdSfoWCFGr9syxAKA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
      defer
    ></script>
    
    <!-- Cấu hình PWA (nếu có) -->
    <link rel="manifest" href="/manifest.json" />
  </head>
  
  <body class="min-h-screen flex flex-col bg-gray-50">
    <!-- Navbar -->
    <Navbar />
    
    <!-- Main content -->
    <main class="flex-grow container px-4 sm:px-6 lg:px-8 py-8 mx-auto">
      <slot />
    </main>
    
    <!-- Footer -->
    <Footer />
    
    <!-- Toast container (chỉ tải khi cần) -->
    {Astro.props.needToast && (
      <script is:inline>
        if (typeof window !== 'undefined') {
          import('react-toastify/dist/ReactToastify.css');
          const { ToastContainer } = await import('react-toastify');
          // Khởi tạo ToastContainer
        }
      </script>
    )}
    
    <!-- Tải các script không quan trọng với defer -->
    <script src="/scripts/main.js" defer></script>
    
    <!-- Lazy load images -->
    <script is:inline>
      if ('loading' in HTMLImageElement.prototype) {
        document.querySelectorAll('img[loading="lazy"]').forEach(img => {
          img.loading = 'lazy';
        });
      }
    </script>
  </body>
</html>